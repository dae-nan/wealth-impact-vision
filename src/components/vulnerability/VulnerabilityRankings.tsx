
import { useState } from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { usePortfolioStore } from '@/store/portfolioStore';
import { ComparisonContent } from './ComparisonContent';
import { SAMPLE_VULNERABILITY_SCORES } from '@/utils/sampleVulnerabilityData';

export const VulnerabilityRankings = () => {
  const { holdingsData, scenarios, calculateImpactForScenario } = usePortfolioStore();
  
  if (!holdingsData) {
    return null;
  }
  
  // Prepare comparison data for rankings
  const comparisonData: Record<string, Record<string, number>> = {};
  
  // Add sample data
  Object.entries(SAMPLE_VULNERABILITY_SCORES || {}).forEach(([individual, scores]) => {
    // Only add if it's not the current portfolio
    if (holdingsData?.individualName !== individual) {
      comparisonData[individual] = scores;
    }
  });
  
  // Calculate vulnerability scores for current portfolio
  const calculateVulnerabilityScores = () => {
    return scenarios.map(scenario => {
      const impact = calculateImpactForScenario(scenario.id);
      return {
        id: scenario.id,
        vulnerabilityScore: impact?.vulnerabilityScore || 0
      };
    });
  };
  
  const scenarioImpacts = calculateVulnerabilityScores();
  
  // Add current portfolio scores
  comparisonData[holdingsData.individualName] = {};
  scenarioImpacts.forEach(scenario => {
    comparisonData[holdingsData.individualName][scenario.id] = scenario.vulnerabilityScore;
  });
  
  return (
    <div className="space-y-6">
      <Card>
        <CardHeader>
          <CardTitle>Vulnerability Rankings Comparison</CardTitle>
          <CardDescription>
            Compare {holdingsData.individualName}'s vulnerability against other high-net-worth individuals
          </CardDescription>
        </CardHeader>
        <CardContent>
          <ComparisonContent 
            sortedData={comparisonData} 
            currentPortfolio={holdingsData.individualName} 
            multiScenario={true}
          />
        </CardContent>
      </Card>
    </div>
  );
};
